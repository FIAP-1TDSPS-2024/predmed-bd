
INSERT INTO USUARIO (id, CPF, CARGO, EMAIL, SENHA, NOME) VALUES (1, '123.456.789-01', 'MÉDICO', 'dr.silva@predmed.com', 'senha123', 'Dr. Carlos Silva');
INSERT INTO USUARIO (id, CPF, CARGO, EMAIL, SENHA, NOME) VALUES (2, '234.567.890-12', 'ENFERMEIRO', 'ana.santos@predmed.com', 'ana2024', 'Ana Santos');
INSERT INTO USUARIO (id, CPF, CARGO, EMAIL, SENHA, NOME) VALUES (3, '345.678.901-23', 'MÉDICO', 'dra.oliveira@predmed.com', 'med2024', 'Dra. Mariana Oliveira');
INSERT INTO USUARIO (id, CPF, CARGO, EMAIL, SENHA, NOME) VALUES (4, '456.789.012-34', 'RECEPCIONISTA', 'joao.pereira@predmed.com', 'joao456', 'João Pereira');
INSERT INTO USUARIO (id, CPF, CARGO, EMAIL, SENHA, NOME) VALUES (5, '567.890.123-45', 'ENFERMEIRO', 'lucia.costa@predmed.com', 'lucia789', 'Lúcia Costa');
INSERT INTO USUARIO (id, CPF, CARGO, EMAIL, SENHA, NOME) VALUES (6, '678.901.234-56', 'MÉDICO', 'dr.souza@predmed.com', 'drSouza123', 'Dr. Paulo Souza');

INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) VALUES (1, TIMESTAMP '2023-03-10 10:30:00', 1);
INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) VALUES (2, TIMESTAMP '2023-03-11 14:15:00', 0);
INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) VALUES (3, TIMESTAMP '2023-03-12 09:45:00', 1);
INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) VALUES (4, TIMESTAMP '2023-03-13 16:20:00', 0);
INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) VALUES (5, TIMESTAMP '2023-03-14 11:10:00', 1);
INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) VALUES (6, TIMESTAMP '2023-03-15 13:30:00', 0);

INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) VALUES (1, DATE '1975-05-15', 0, '(11)99999-1111', '111.222.333-44', 'roberto@email.com', 'Roberto Almeida', 1);
INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) VALUES (2, DATE '1988-10-22', 1, '(11)99999-2222', '222.333.444-55', 'patricia@email.com', 'Patricia Ferreira', 2);
INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) VALUES (3, DATE '1965-03-30', 0, '(11)99999-3333', '333.444.555-66', 'jose@email.com', 'José Santos', 3);
INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) VALUES (4, DATE '1992-12-05', 1, '(11)99999-4444', '444.555.666-77', 'mariana@email.com', 'Mariana Lima', 1);
INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) VALUES (5, DATE '1980-08-18', 0, '(11)99999-5555', '555.666.777-88', 'carlos@email.com', 'Carlos Oliveira', 4);
INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) VALUES (6, DATE '1995-04-25', 1, '(11)99999-6666', '666.777.888-99', 'fernanda@email.com', 'Fernanda Costa', 5);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (1, DATE '2023-03-10', 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 1, 1, 2);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (2, DATE '2023-03-11', 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 2, 2, 3);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (3, DATE '2023-03-12', 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 3, 3, 1);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (4, DATE '2023-03-13', 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 4, 4, 2);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (5, DATE '2023-03-14', 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0, 5, 5, 5);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (6, DATE '2023-03-15', 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 1, 0, 6, 6, 4);

INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) 
VALUES (7, DATE '1955-07-10', 0, '(11)99999-7777', '777.888.999-00', 'antonio@email.com', 'Antonio Pereira', 1);

INSERT INTO PACIENTE (id, DATA_NASC, SEXO, CELULAR, CPF, EMAIL, NOME, registrouPaciente_id) 
VALUES (8, DATE '1950-03-22', 1, '(11)99999-8888', '888.999.000-11', 'maria@email.com', 'Maria Silva', 3);

INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) 
VALUES (7, TIMESTAMP '2023-03-16 09:20:00', 1);

INSERT INTO DIAGNOSTICO (id, DATA_HORA_DIAGNOSTICO, PROVAVEL_COVID) 
VALUES (8, TIMESTAMP '2023-03-17 10:45:00', 1);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (7, DATE '2023-03-16', 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 7, 7, 1);

INSERT INTO TRIAGEM (id, DATA_TRIAGEM, ASMA, CONTATO_INFECTADO, CORIZA, DIABETES, DOENCA_CARDIACA, DOENCA_PULMONAR_CRONICA, DOR_CABECAC, DOR_GARGANTA, FADIGA, FAMILIAR_LOCAL_PUBLICO, FEBRE, HIPERTENSAO, LOCAL_PUBLICO, MULIDAO, PROBLEMAS_GASTRO, PROBLEMA_RESPIRATORIO, TOSSE_SECA, VIAGEM_EXTERIOR, diagnostico_id, paciente_id, registrouTriagem_id) 
VALUES (8, DATE '2023-03-17', 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 8, 8, 3);

SELECT 
    p.NOME AS "Nome do Paciente",
    p.CPF AS "CPF do Paciente",
    TO_CHAR(p.DATA_NASC, 'DD/MM/YYYY') AS "Data de Nascimento",
    CASE WHEN p.SEXO = 0 THEN 'Masculino' ELSE 'Feminino' END AS "Sexo",
    TO_CHAR(t.DATA_TRIAGEM, 'DD/MM/YYYY') AS "Data da Triagem",
    TO_CHAR(d.DATA_HORA_DIAGNOSTICO, 'DD/MM/YYYY HH24:MI') AS "Data do Diagnóstico",
    CASE WHEN d.PROVAVEL_COVID = 1 THEN 'Positivo' ELSE 'Negativo' END AS "Diagnóstico COVID",
    u1.NOME AS "Registrado por",
    u2.NOME AS "Triagem feita por"
FROM 
    PACIENTE p
JOIN 
    TRIAGEM t ON p.id = t.paciente_id
JOIN 
    DIAGNOSTICO d ON t.diagnostico_id = d.id
JOIN 
    USUARIO u1 ON p.registrouPaciente_id = u1.id
JOIN 
    USUARIO u2 ON t.registrouTriagem_id = u2.id
WHERE 
    d.PROVAVEL_COVID = 1
ORDER BY 
    d.DATA_HORA_DIAGNOSTICO DESC;

SELECT 
    u.NOME AS "Nome do Profissional",
    u.CARGO AS "Cargo",
    COUNT(t.id) AS "Número de Triagens",
    SUM(CASE WHEN d.PROVAVEL_COVID = 1 THEN 1 ELSE 0 END) AS "Casos Positivos",
    ROUND(AVG(CASE WHEN d.PROVAVEL_COVID = 1 THEN 100 ELSE 0 END), 2) AS "% Positivos"
FROM 
    USUARIO u
JOIN 
    TRIAGEM t ON u.id = t.registrouTriagem_id
JOIN 
    DIAGNOSTICO d ON t.diagnostico_id = d.id
GROUP BY 
    u.id, u.NOME, u.CARGO
HAVING 
    COUNT(t.id) > 1
ORDER BY 
    COUNT(t.id) DESC;

SELECT 
    p.NOME AS "Nome do Paciente",
    TO_CHAR(p.DATA_NASC, 'DD/MM/YYYY') AS "Data de Nascimento",
    FLOOR((SYSDATE - p.DATA_NASC) / 365.25) AS "Idade",
    CASE 
        WHEN FLOOR((SYSDATE - p.DATA_NASC) / 365.25) >= 60 THEN 'Grupo de Risco - Idade'
        WHEN EXISTS (
            SELECT 1 FROM TRIAGEM t 
            WHERE t.paciente_id = p.id 
            AND (t.DIABETES = 1 OR t.DOENCA_CARDIACA = 1 OR t.HIPERTENSAO = 1)
        ) THEN 'Grupo de Risco - Comorbidade'
        ELSE 'Fora do Grupo de Risco'
    END AS "Classificação de Risco",
    TO_CHAR(t.DATA_TRIAGEM, 'DD/MM/YYYY') AS "Data da Triagem"
FROM 
    PACIENTE p
JOIN 
    TRIAGEM t ON p.id = t.paciente_id
WHERE 
    p.id IN (
        SELECT paciente_id 
        FROM TRIAGEM 
        WHERE CONTATO_INFECTADO = 1 OR LOCAL_PUBLICO = 1
    )
ORDER BY 
    FLOOR((SYSDATE - p.DATA_NASC) / 365.25) DESC;

SELECT 
    u.id AS "ID do Médico",
    u.NOME AS "Nome do Médico",
    u.EMAIL AS "Email de Contato"
FROM 
    USUARIO u
WHERE 
    u.CARGO = 'MÉDICO'
    AND EXISTS (
        SELECT 1
        FROM PACIENTE p
        JOIN TRIAGEM t ON p.id = t.paciente_id
        JOIN DIAGNOSTICO d ON t.diagnostico_id = d.id
        WHERE p.registrouPaciente_id = u.id
        AND d.PROVAVEL_COVID = 1
    )
ORDER BY 
    u.NOME;

SELECT 
    t.id AS "ID Triagem",
    p.NOME AS "Nome do Paciente",
    CASE WHEN d.PROVAVEL_COVID = 1 THEN 'Positivo' ELSE 'Negativo' END AS "Resultado COVID",
    TO_CHAR(t.DATA_TRIAGEM, 'DD/MM/YYYY') AS "Data da Triagem",
    (
        t.FEBRE + 
        t.TOSSE_SECA + 
        t.DOR_CABECAC + 
        t.DOR_GARGANTA + 
        t.PROBLEMA_RESPIRATORIO
    ) AS "Soma Sintomas Principais",
    CASE
        WHEN (t.FEBRE + t.TOSSE_SECA + t.PROBLEMA_RESPIRATORIO >= 2) THEN 'Alto'
        WHEN (t.FEBRE = 1 OR t.TOSSE_SECA = 1 OR t.PROBLEMA_RESPIRATORIO = 1) THEN 'Médio'
        ELSE 'Baixo'
    END AS "Nível de Risco",
    CASE WHEN FLOOR((SYSDATE - p.DATA_NASC) / 365.25) >= 60 THEN 'Sim' ELSE 'Não' END AS "Grupo de Risco por Idade"
FROM 
    TRIAGEM t
JOIN 
    PACIENTE p ON t.paciente_id = p.id
JOIN 
    DIAGNOSTICO d ON t.diagnostico_id = d.id
ORDER BY 
    d.PROVAVEL_COVID DESC,
    (t.FEBRE + t.TOSSE_SECA + t.DOR_CABECAC + t.DOR_GARGANTA + t.PROBLEMA_RESPIRATORIO) DESC;
